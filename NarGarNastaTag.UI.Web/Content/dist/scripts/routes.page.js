webpackJsonp([0],{0:function(e,exports,t){(function($){var e=t(3),o=t(5),r=t(1),Q=t(6),a=function(){function t(){this.routeQueue=[],this.numberOfRoutesToCheck=-1,this.numberOfRoutesChecked=0,this.routesFound=!1}return t.prototype.load=function(){var t=this;this.commuterController=new e,$.mobile.loading("show",{text:"Laddar kommande avgångar...",textVisible:!1,theme:"a",html:""}),this.getFavouriteRoutes(function(e,r){if(!r&&(t.numberOfRoutesChecked===t.numberOfRoutesToCheck||-1===t.numberOfRoutesToCheck)){var a=(new Date).getHours();(a>=22||5>=a)&&$("#noRoutesFoundPopup .nighttimeInfo").show(),$("#noRoutesFoundPopup").popup("open"),e&&(new o).inform(e)}$.mobile.loading("hide")})},t.prototype.getFavouriteRoutes=function(e){var t=this,o=decodeURIComponent(window.location.href),a=RegExp("from\\/[\\d\\,\\wåäöÅÄÖ]+").exec(o),n=a&&a[0].replace("from/","");a=RegExp("to\\/[\\d\\,\\wåäöÅÄÖ]+").exec(o);var u=a&&a[0].replace("to/","");t.commuterController.scrapeStationRoutes(n,function(o){if(!o.data||0===o.data.length)return void e("No results for query.",!1);for(t.numberOfRoutesToCheck=o.data.length||1;t.numberOfRoutesChecked<t.numberOfRoutesToCheck;t.numberOfRoutesChecked++){var a=o.data.Url||o.data[t.numberOfRoutesChecked].Url,i=r.getQueryStringParameterByName(a,"train"),d=i.split(",")[0],p=i.split(",")[1],s={index:t.numberOfRoutesChecked,routeDate:d,trainNo:p,fromStationId:n,toStationId:u};t.routeQueue.push(s)}var l=$("#routeItemTemplate").clone();$("#routes").html("").append(l),t.queryRoutes(l,function(t){e&&e("",t)})})},t.prototype.queryRoutes=function(e,t){var o=this;return o.routeQueue&&0!==o.routeQueue.length?o.routeQueue.map(o.queryRoute.bind(o)).map(function(r){return function(){$.noop;return r.then(function(r,a){o.routesFound=!0,t&&t(o.routesFound),o.displayRoute(r,e,t)})}}).reduce(Q.when,Q):void(t&&t(o.routesFound))},t.prototype.queryRoute=function(e){$.support.cors=!0;var t=this;return Q($.ajax({url:t.commuterController.getApiUrl()+"/query/date/"+e.routeDate+"/route/"+parseInt(e.trainNo)+"/from/"+e.fromStationId+"/to/"+e.toStationId,type:"GET",dataType:"json",cache:!1,timeout:5e3}))},t.prototype.displayRoute=function(e,t,o){if(e&&!(e.length<=0)){var r=e[0],a=t.clone();a.prop("id",this.commuterController.idGenerator.getId());var n=$(".route").length,u=n%2===0?"even":"odd";a.addClass(u);var i=a.find(".trainNo");i.text(r.RouteNo);var d=a.find(".fromStation");d.text(r.FromStation.StationName);var p=a.find(".toStation");p.text(r.ToStation.StationName);var s=a.find(".departure");if(r.FromStation.UpdatedDeparture){if(s.text(r.FromStation.UpdatedDeparture),r.FromStation.ScheduledDeparture){var l=a.find(".scheduledDeparture");l.text(r.FromStation.ScheduledDeparture);var c=a.find(".departureDelayed");c.removeClass("hide")}}else s.text(r.FromStation.ScheduledDeparture);var f=a.find(".notes"),h=[];r.FromStation.IsCancelled&&h.push("ställts in");var m=a.find(".arrival");if(r.FromStation.IsCancelled)m.text("");else{var v=r.ToStation.UpdatedArrival||r.ToStation.ScheduledArrival;if(v){if(r.ToStation.UpdatedArrival&&r.ToStation.ScheduledArrival){var S=a.find(".scheduledArrival");S.text(r.ToStation.ScheduledArrival);var g=a.find(".arrivalDelayed");g.removeClass("hide")}}else v=r.ToStation.UpdatedDeparture||r.ToStation.ScheduledDeparture;m.text(v);var T=a.find(".departureTrack");T.text(r.FromStation.Track);var R=a.find(".arrivalTrack");R.text(r.ToStation.Track)}if(r.FromStation.IsCancelled||(h.push(r.FromStation.UpdatedDeparture?"uppdaterad avgångstid":"avgångstid enligt tidtabell"),r.FromStation.TrackChanged&&h.push("uppdaterat avgångsspår"),r.ToStation.TrackChanged&&h.push("uppdaterat ankomstspår"),!r.ToStation.ScheduledArrival&&h.push("uppskattad ankomstid"),r.ToStation.UpdatedArrival&&h.push("uppdaterad ankomstid")),f.text("Tåget har "+h.join(", ")+"."),r.TrainOperator){var C=a.find(".trainOperator");C.text(r.TrainOperator)}else a.find(".hasTrainOperator").hide();var k=a.find(".routeInfo"),x=k.prop("href");k.prop("href",x.replace("route=","route="+r.StartDate+","+r.RouteNo+"&no=").replace("http://"+window.location.host,""));var y=$("#routes");y.append(a),a.fadeIn("slow");var y=$("#routes")}},t.prototype.clearQueue=function(){this.routeQueue=[]},t}(),n=new a;$(document).on("pageshow","#routesPage",function(){n.load()}),$(document).on("pagehide","#routesPage",function(){n.clearQueue()})}).call(exports,t(2))},6:function(e,exports,t){e.exports=Q}});